FORMAT: 1A
HOST: https://example.com/api/v1

# Good STV

Good STV is a simple API allowing a group of people to vote on a minor election,
such as a student society committee position.

# Poll collection [/polls]

## Create a poll [POST]

This action creates a new poll. It takes a JSON object containing a title and a
list of candidates.

+ Request (application/json)
    + Attributes
        + poll: Redbrick treasurer election. (string, required) - The poll name. Limit 32 characters
        + choices: Alice, Bob, Charlie (array[string], required) - The names of each of the candidates.

+ Response 201 (application/json)
    + Headers
        ```
        Location: /polls/a1b2c3
        ```
    + Attributes
        + id: a1b2c3 (string, required) - ID of the poll, generated by the server.
        + admin_key: abcdef123456 (string, required) - Admin key for idetifying.
    + Schema
        ```
        {
          "$schema": "http://json-schema.org/draft-04/schema#",
          "type": "object",
          "required": ["admin_key", "id"],
          "properties": {
            "id": {
              "type": "string",
              "pattern": "^[a-z0-9]{6}$"
            },
            "admin_key": {
              "type": "string",
              "pattern": "^[a-z0-9]{12}$"
            }
          }
        }
        ```


# Poll [/polls/{id}]

+ Parameters
    + id: a1b2c3 (string ^[a-z0-9]{6}$, required) - Unique identifier for the poll

## View details of a poll [GET]

+ Response 200 (application/json)
    + Body
      ```json
      {
          "poll": "Redbrick treasurer election.",
          "created_at": "2019-01-18T14:38:20,307253825+00:00",
          "in_progress": "true",
          "candidates": [
              {
                  "id": "alice",
                  "name": "Alice"
              }, {
                  "id": "bob_smith",
                  "name": "Bob Smith"
              }, {
                  "id": "charlie",
                  "name": "Charlie"
              }
          ]
      }
      ```

## Submit a vote [POST]

Submit preferences for a candidate/set of candidates. This action sets a cookie
with the poll id so that a browser cannot vote in the same poll twice.

+ Request (application/json)
    + Attributes
        + preferences: bob_smith, alice, charlie (array[string], required) - Ordered list of candidate ids, ordered from most preferred to least preferred.
+ Response 201
    + Headers
        ```
        Set-Cookie: voted_a1b2c3=true
        ```

# Poll results [/polls/{id}/results]

Only the admin (the creator of the poll) can view the poll results.

+ Parameters
    + id: a1b2c3 (string ^a-z0-9{6}$, required) - Unique identifier for the poll

## Close the poll and calculate the results [POST]

This requires the admin key provided on creation of the poll. This sets the
`in_progress` field of the poll to false, and prevents further votes.

+ Request (application/json)
    + Attributes
        + admin_key: abcdef123456 (string, required) - The admin key provided on poll creation.
    + Schema
        ```
        {
          "$schema": "http://json-schema.org/draft-04/schema#",
          "type": "object",
          "required": ["admin_key"],
          "properties": {
            "admin_key": {
              "type": "string",
              "pattern": "^[a-z0-9]{12}$"
            }
          }
        }
        ```


+ Response 200 (application/json)
  + Attributes (Poll Results)
  + Body
    ```
    {
        "created_at": "2019-01-18T15:11:46,859932952+00:00",
        "results": [
            { "id": "bob_smith", "votes": 100 },
            { "id": "alice", "votes": 70 },
            { "id": "charlie", "votes": 15 }
        ]
    }
    ```

## View the results of the poll [GET]

Returns the list of candidates, ordered by number of 1st preference votes as of
the final round, descending.

* Response 200 (application/json)
  + Attributes (Poll Results)
  + Body
    ```
    {
        "created_at": "2019-01-18T15:11:46,859932952+00:00",
        "results": [
            { "id": "bob_smith", "votes": 100 },
            { "id": "alice", "votes": 70 },
            { "id": "charlie", "votes": 15 }
        ]
    }
    ```

# Data Structures

## Poll Results
+ created_at: `2019-01-18T15:11:46Z` (string, required) - The timestamp at which this poll starts
+ results (array[Result], required) - The Results of the the poll

## Result
+ id: `bob_smith` (string, required) - the identifier of the candidate
+ votes: 100 (number, required) - number of votes candidate got
